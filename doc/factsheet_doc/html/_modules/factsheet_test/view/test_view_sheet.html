

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>factsheet_test.view.test_view_sheet &mdash; Factsheet 0.5.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Factsheet
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/toc_guide.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../src/toc_src.html">Source Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../test/toc_test.html">Unit Test Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../test_manual/toc_test_manual.html">Manual Tests</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Factsheet</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>factsheet_test.view.test_view_sheet</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for factsheet_test.view.test_view_sheet</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Unit tests for class to display Factsheet document.  See</span>
<span class="sd">:mod:`.view_sheet`.</span>

<span class="sd">.. include:: /test/refs_include_pytest.txt</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="c1"># import math</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pytest</span>   <span class="c1"># type: ignore[import]</span>

<span class="kn">import</span> <span class="nn">factsheet.bridge_ui</span> <span class="k">as</span> <span class="nn">BUI</span>
<span class="c1"># from factsheet.content.note import spec_note as XSPEC_NOTE</span>
<span class="kn">import</span> <span class="nn">factsheet.control.control_sheet</span> <span class="k">as</span> <span class="nn">CSHEET</span>
<span class="c1"># import factsheet.model.sheet as MSHEET</span>
<span class="kn">import</span> <span class="nn">factsheet.model.sheet</span> <span class="k">as</span> <span class="nn">MSHEET</span>
<span class="c1"># from factsheet.model import topic as MTOPIC</span>
<span class="c1"># from factsheet.view import query_place as QPLACE</span>
<span class="c1"># from factsheet.view import query_template as QTEMPLATE</span>
<span class="c1"># import factsheet.view.view_markup as VMARKUP</span>
<span class="kn">import</span> <span class="nn">factsheet.view.view_sheet</span> <span class="k">as</span> <span class="nn">VSHEET</span>
<span class="c1"># from factsheet.view import scenes as VSCENES</span>
<span class="c1"># from factsheet.view import form_topic as VTOPIC</span>
<span class="c1"># from factsheet.view import types_view as VTYPES</span>
<span class="c1"># from factsheet.view import ui as UI</span>
<span class="c1"># from factsheet.view import view_infoid as VINFOID</span>

<span class="kn">import</span> <span class="nn">gi</span>   <span class="c1"># type: ignore[import]</span>
<span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s1">&#39;Gtk&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0&#39;</span><span class="p">)</span>
<span class="c1"># from gi.repository import Gdk   # type: ignore[import]    # noqa: E402</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">GObject</span> <span class="k">as</span> <span class="n">GO</span>  <span class="c1"># type: ignore[import] # noqa: E402</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">Gtk</span>   <span class="c1"># type: ignore[import]    # noqa: E402</span>
<span class="c1"># from gi.repository import Pango  # type: ignore[import]    # noqa: E402</span>


<span class="c1"># class PatchCall:</span>
<span class="c1">#     def __init__(self, p_response):</span>
<span class="c1">#         self.response = p_response</span>
<span class="c1">#         self.called = False</span>
<span class="c1">#</span>
<span class="c1">#     def __call__(self):</span>
<span class="c1">#         self.called = True</span>
<span class="c1">#         return self.response</span>


<div class="viewcode-block" id="gtk_app_window"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.gtk_app_window">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">gtk_app_window</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Fixture with teardown: return `GTK.ApplicationWindow &lt;gtk_app_window_&gt;`_.</span>

<span class="sd">    .. _gtk_app_window: https://lazka.github.io/pgi-docs/</span>
<span class="sd">       #Gtk-3.0/classes/ApplicationWindow.html#Gtk.ApplicationWindow</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gtk_window</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ApplicationWindow</span><span class="p">()</span>
    <span class="k">yield</span> <span class="n">gtk_window</span>
    <span class="n">gtk_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="patch_dialog_choose"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.patch_dialog_choose">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">patch_dialog_choose</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pytest fixture returns stub</span>
<span class="sd">    `GtkFileChooserDialog &lt;GtkFileChooserDialog_&gt;`_.</span>

<span class="sd">    :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">    :param request: built-in fixture `Pytest request`_.</span>

<span class="sd">    .. _GtkFileChooserDialog: https://lazka.github.io/pgi-docs/</span>
<span class="sd">       #Gtk-3.0/classes/FileChooserDialog.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">PatchDialog</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">get_closest_marker</span><span class="p">(</span><span class="s1">&#39;dialog_choose&#39;</span><span class="p">)</span>
            <span class="n">suggest</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">NONE</span>
            <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">suggest</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;suggest&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;response&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">called_get_filename</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called_hide</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called_run</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called_set_current_name</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called_set_filename</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_suggest</span> <span class="o">=</span> <span class="n">suggest</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">response</span>

        <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called_get_filename</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>

        <span class="k">def</span> <span class="nf">hide</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called_hide</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called_run</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>

        <span class="k">def</span> <span class="nf">set_current_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called_set_current_name</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">set_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_filename</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">p_filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called_set_filename</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">dialog</span> <span class="o">=</span> <span class="n">PatchDialog</span><span class="p">()</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
        <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserDialog</span><span class="p">,</span> <span class="s1">&#39;get_filename&#39;</span><span class="p">,</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_filename</span><span class="p">)</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
        <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserDialog</span><span class="p">,</span> <span class="s1">&#39;hide&#39;</span><span class="p">,</span> <span class="n">dialog</span><span class="o">.</span><span class="n">hide</span><span class="p">)</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
        <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserDialog</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="n">dialog</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
        <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserDialog</span><span class="p">,</span> <span class="s1">&#39;set_current_name&#39;</span><span class="p">,</span> <span class="n">dialog</span><span class="o">.</span><span class="n">set_current_name</span><span class="p">)</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
        <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserDialog</span><span class="p">,</span> <span class="s1">&#39;set_filename&#39;</span><span class="p">,</span> <span class="n">dialog</span><span class="o">.</span><span class="n">set_filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dialog</span></div>


<div class="viewcode-block" id="patch_g_control_app"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.patch_g_control_app">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">patch_g_control_app</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Pytest fixture with teardown: Reset :data:`.g_control_app`.&quot;&quot;&quot;</span>
    <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlApp</span><span class="p">()</span>
    <span class="k">yield</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span>
    <span class="n">control_app</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="n">control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">_roster_views</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">view</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">view</span><span class="o">.</span><span class="n">_window</span>
        <span class="n">sheet</span><span class="o">.</span><span class="n">_roster_views</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlApp</span><span class="p">()</span></div>


<div class="viewcode-block" id="patch_get_path"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.patch_get_path">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">patch_get_path</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pytest fixture: patch :meth:`.ViewSheet.get_path` to return value</span>
<span class="sd">    set with pytest mark.</span>

<span class="sd">    :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">    :param request: built-in fixture `Pytest request`_.</span>
<span class="sd">    :param tmp_path: built-in fixture `Pytest tmp_path`_.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">get_closest_marker</span><span class="p">(</span><span class="s2">&quot;get_path&quot;</span><span class="p">)</span>
    <span class="n">cancel</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cancel</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cancel&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">cancel</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmp_path</span> <span class="o">/</span> <span class="s1">&#39;Parrot.fsg&#39;</span><span class="p">)</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
        <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">,</span> <span class="s1">&#39;get_path&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_s</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_p</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span></div>


<div class="viewcode-block" id="patch_is_stale"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.patch_is_stale">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">patch_is_stale</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pytest fixture: patch :meth:`.Sheet.is_stale` to return value set</span>
<span class="sd">    with pytest mark.</span>

<span class="sd">    :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">    :param request: built-in fixture `Pytest request`_.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">PatchIsStale</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_is_stale</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_stale</span> <span class="o">=</span> <span class="n">p_is_stale</span>

        <span class="k">def</span> <span class="nf">is_stale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_stale</span>

    <span class="n">marker</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">get_closest_marker</span><span class="p">(</span><span class="s2">&quot;is_stale&quot;</span><span class="p">)</span>
    <span class="n">is_stale</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">marker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">is_stale</span> <span class="o">=</span> <span class="n">marker</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;is_stale&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="n">patch</span> <span class="o">=</span> <span class="n">PatchIsStale</span><span class="p">(</span><span class="n">p_is_stale</span><span class="o">=</span><span class="n">is_stale</span><span class="p">)</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">MSHEET</span><span class="o">.</span><span class="n">Sheet</span><span class="p">,</span> <span class="s1">&#39;is_stale&#39;</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">is_stale</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">patch</span></div>


<div class="viewcode-block" id="PatchSetApp"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.PatchSetApp">[docs]</a><span class="k">class</span> <span class="nc">PatchSetApp</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Patch for</span>
<span class="sd">    `Gtk.ApplicationWindow.set_application &lt;set_application_&gt;`_.</span>

<span class="sd">    Tests cannot complete `Gtk.Application`_ setup in the test</span>
<span class="sd">    environment.  This class and fixture :func:`patch_set_app` patch</span>
<span class="sd">    around the incomplete setup.</span>

<span class="sd">    .. _`Gtk.Application`: https://lazka.github.io/pgi-docs/</span>
<span class="sd">       #Gtk-3.0/classes/Application.html</span>

<span class="sd">    .. _set_application: https://lazka.github.io/pgi-docs/</span>
<span class="sd">       #Gtk-3.0/classes/Window.html#Gtk.Window.set_application</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PatchSetApp.__init__"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.PatchSetApp.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initially, mark patch as not called.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apps</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="PatchSetApp.set_application"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.PatchSetApp.set_application">[docs]</a>    <span class="k">def</span> <span class="nf">set_application</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_app</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mark patch as called and record application argument.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_app</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="patch_set_app"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.patch_set_app">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">patch_set_app</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pytest fixture: prevents call to</span>
<span class="sd">    `Gtk.ApplicationWindow.set_application &lt;set_application_&gt;`_ in test</span>
<span class="sd">    environment.</span>

<span class="sd">    :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">PatchSetApp</span><span class="p">()</span>
    <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="s1">&#39;set_application&#39;</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">set_application</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">patch</span></div>


<div class="viewcode-block" id="TestAppFactsheet"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestAppFactsheet">[docs]</a><span class="k">class</span> <span class="nc">TestAppFactsheet</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Unit tests for :class:`~.view_sheet.AppFactsheet`.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestAppFactsheet.test_do_activate"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestAppFactsheet.test_do_activate">[docs]</a>    <span class="k">def</span> <span class="nf">test_do_activate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm activation with initial window.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchOnNew</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">def</span> <span class="nf">on_new_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_t</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">patch_on_new</span> <span class="o">=</span> <span class="n">PatchOnNew</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">,</span> <span class="s1">&#39;on_new_sheet&#39;</span><span class="p">,</span> <span class="n">patch_on_new</span><span class="o">.</span><span class="n">on_new_sheet</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">AppFactsheet</span><span class="p">()</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">do_activate</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">patch_on_new</span><span class="o">.</span><span class="n">called</span></div>

<div class="viewcode-block" id="TestAppFactsheet.test_do_open"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestAppFactsheet.test_do_open">[docs]</a>    <span class="k">def</span> <span class="nf">test_do_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm factsheet open with initial window.</span>
<span class="sd">        | Case: open succeeds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="c1"># Test</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Pending implementation of file open&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestAppFactsheet.test_do_open_warn"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestAppFactsheet.test_do_open_warn">[docs]</a>    <span class="k">def</span> <span class="nf">test_do_open_warn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm factsheet open with initial window.</span>
<span class="sd">        | Case: open fails</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="c1"># Test</span>
        <span class="n">pytest</span><span class="o">.</span><span class="n">xfail</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Pending implementation of file open&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestAppFactsheet.test_do_shutdown"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestAppFactsheet.test_do_shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">test_do_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">caplog</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm extension of application shutdown.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param caplog: built-in fixture `Pytest caplog`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="c1"># Bare call to superclass do_shutdown causes segmentation fault</span>
        <span class="k">class</span> <span class="nc">PatchAppDoShutdown</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">def</span> <span class="nf">do_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_app</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">patch</span> <span class="o">=</span> <span class="n">PatchAppDoShutdown</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">Gtk</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="s1">&#39;do_shutdown&#39;</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">do_shutdown</span><span class="p">)</span>

        <span class="n">caplog</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="n">N_LOGS</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">LAST</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">log_message</span> <span class="o">=</span> <span class="s1">&#39;AppFactsheet application shutdown.&#39;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">AppFactsheet</span><span class="p">()</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">do_shutdown</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">patch</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">N_LOGS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">LAST</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">log_message</span> <span class="o">==</span> <span class="n">record</span><span class="o">.</span><span class="n">message</span>
        <span class="k">assert</span> <span class="s1">&#39;INFO&#39;</span> <span class="o">==</span> <span class="n">record</span><span class="o">.</span><span class="n">levelname</span></div>

<div class="viewcode-block" id="TestAppFactsheet.test_do_startup"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestAppFactsheet.test_do_startup">[docs]</a>    <span class="k">def</span> <span class="nf">test_do_startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">caplog</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm extension of application startup.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param caplog: built-in fixture `Pytest caplog`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="c1"># Bare call to superclass do_startup causes segmentation fault</span>
        <span class="k">class</span> <span class="nc">PatchAppDoStartup</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">def</span> <span class="nf">do_startup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_app</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">patch</span> <span class="o">=</span> <span class="n">PatchAppDoStartup</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">Gtk</span><span class="o">.</span><span class="n">Application</span><span class="p">,</span> <span class="s1">&#39;do_startup&#39;</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">do_startup</span><span class="p">)</span>

        <span class="n">caplog</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="n">N_LOGS</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">LAST</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">log_message</span> <span class="o">=</span> <span class="s1">&#39;AppFactsheet application startup.&#39;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">AppFactsheet</span><span class="p">()</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">do_startup</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">patch</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">N_LOGS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">LAST</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">log_message</span> <span class="o">==</span> <span class="n">record</span><span class="o">.</span><span class="n">message</span>
        <span class="k">assert</span> <span class="s1">&#39;INFO&#39;</span> <span class="o">==</span> <span class="n">record</span><span class="o">.</span><span class="n">levelname</span></div>

<div class="viewcode-block" id="TestAppFactsheet.test_init"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestAppFactsheet.test_init">[docs]</a>    <span class="k">def</span> <span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm initialization.&quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">app_id</span> <span class="o">=</span> <span class="s1">&#39;com.novafolks.factsheet&#39;</span>
        <span class="c1"># Test</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">AppFactsheet</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Application</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">app_id</span> <span class="o">==</span> <span class="n">target</span><span class="o">.</span><span class="n">get_application_id</span><span class="p">()</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">target</span><span class="o">.</span><span class="n">get_windows</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="TestNewDialogWarn"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestNewDialogWarn">[docs]</a><span class="k">class</span> <span class="nc">TestNewDialogWarn</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Unit tests for :func:`.new_dialog_warn_loss`.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestNewDialogWarn.test_new_dialog_warn_loss"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestNewDialogWarn.test_new_dialog_warn_loss">[docs]</a>    <span class="k">def</span> <span class="nf">test_new_dialog_warn_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gtk_app_window</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm data loss warning dialog construction.</span>

<span class="sd">        :param gtk_app_window: fixture :func:`.gtk_app_window`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">PARENT</span> <span class="o">=</span> <span class="n">gtk_app_window</span>
        <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;Parrot Sketch&lt;/b&gt;&#39;</span>
        <span class="n">WARN</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Factsheet </span><span class="si">{}</span><span class="s1"> contains unsaved changes.  All unsaved&#39;</span>
                <span class="s1">&#39; changes will be discarded if you close.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NAME</span><span class="p">)</span>
        <span class="n">I_DIALOG</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">I_WARN</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">I_CANCEL</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">TEXT_CANCEL</span> <span class="o">=</span> <span class="s1">&#39;Cancel&#39;</span>
        <span class="n">I_APPLY</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">TEXT_APPLY</span> <span class="o">=</span> <span class="s1">&#39;Discard&#39;</span>
        <span class="c1"># Test</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">new_dialog_warn_loss</span><span class="p">(</span><span class="n">p_parent</span><span class="o">=</span><span class="n">PARENT</span><span class="p">,</span> <span class="n">p_name</span><span class="o">=</span><span class="n">NAME</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Dialog</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">get_transient_for</span><span class="p">()</span> <span class="ow">is</span> <span class="n">PARENT</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">get_destroy_with_parent</span><span class="p">()</span>
        <span class="n">box_content</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_content_area</span><span class="p">()</span>
        <span class="n">box_warn</span> <span class="o">=</span> <span class="n">box_content</span><span class="o">.</span><span class="n">get_children</span><span class="p">()[</span><span class="n">I_DIALOG</span><span class="p">]</span>
        <span class="n">label_warn</span> <span class="o">=</span> <span class="n">box_warn</span><span class="o">.</span><span class="n">get_children</span><span class="p">()[</span><span class="n">I_WARN</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label_warn</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">WARN</span> <span class="o">==</span> <span class="n">label_warn</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
        <span class="n">header_bar</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_header_bar</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header_bar</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">HeaderBar</span><span class="p">)</span>
        <span class="n">buttons</span> <span class="o">=</span> <span class="n">header_bar</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span>
        <span class="n">button_cancel</span> <span class="o">=</span> <span class="n">buttons</span><span class="p">[</span><span class="n">I_CANCEL</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">TEXT_CANCEL</span> <span class="o">==</span> <span class="n">button_cancel</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">get_widget_for_response</span><span class="p">(</span>
            <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span> <span class="ow">is</span> <span class="n">button_cancel</span>
        <span class="k">assert</span> <span class="n">button_cancel</span><span class="o">.</span><span class="n">get_style_context</span><span class="p">(</span>
            <span class="p">)</span><span class="o">.</span><span class="n">has_class</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">STYLE_CLASS_SUGGESTED_ACTION</span><span class="p">)</span>
        <span class="n">button_apply</span> <span class="o">=</span> <span class="n">buttons</span><span class="p">[</span><span class="n">I_APPLY</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">TEXT_APPLY</span> <span class="o">==</span> <span class="n">button_apply</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">get_widget_for_response</span><span class="p">(</span>
            <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">APPLY</span><span class="p">)</span> <span class="ow">is</span> <span class="n">button_apply</span>
        <span class="k">assert</span> <span class="n">button_apply</span><span class="o">.</span><span class="n">get_style_context</span><span class="p">(</span>
            <span class="p">)</span><span class="o">.</span><span class="n">has_class</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">STYLE_CLASS_DESTRUCTIVE_ACTION</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestViewSheet"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet">[docs]</a><span class="k">class</span> <span class="nc">TestViewSheet</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Unit tests for :class:`.ViewSheet`.</span>

<span class="sd">    The following manual tests are needed to confirm placement,</span>
<span class="sd">    appearance, and behavior of :class:`.ViewSheet` components.</span>

<span class="sd">    * :doc:`../test_manual/test_cases/case_sheet_name` for Factsheet name</span>
<span class="sd">    * :doc:`../test_manual/test_cases/case_sheet_open_view` for new</span>
<span class="sd">      Factsheet window.</span>
<span class="sd">    * :doc:`../test_manual/test_cases/case_sheet_summary` for Factsheet summary</span>
<span class="sd">    * :doc:`../test_manual/test_cases/case_sheet_title` for Factsheet title</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestViewSheet.test_class_constants"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_class_constants">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;NAME, TYPE&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;NAME_FILE_SHEET_UI&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;NAME_FILE_DIALOG_DATA_LOSS_UI&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
        <span class="c1"># (&#39;CANCEL_CLOSE&#39;, bool),</span>
        <span class="c1"># (&#39;CONTINUE_CLOSE&#39;, bool),</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_class_constants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NAME</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm class defines constants.</span>

<span class="sd">        :param NAME: name of constant.</span>
<span class="sd">        :param TYPE: type of constant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">item</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">,</span> <span class="n">NAME</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">TYPE</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestViewSheet.test_init"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_init">[docs]</a>    <span class="k">def</span> <span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_set_app</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm initialization.</span>
<span class="sd">        | Case: visual elements.</span>

<span class="sd">        :param patch_set_app: fixture :func:`.patch_set_app`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="n">patch_set_app</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># # target._window.set_skip_pager_hint(True)</span>
        <span class="c1"># # target._window.set_skip_taskbar_hint(True)</span>
        <span class="c1"># target._window.set_transient_for(WINDOW_ANCHOR)</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="o">.</span><span class="n">ALLOW_CLOSE</span>
        <span class="k">assert</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="o">.</span><span class="n">DENY_CLOSE</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_control</span> <span class="ow">is</span> <span class="n">control</span>
        <span class="k">assert</span> <span class="n">control</span><span class="o">.</span><span class="n">_roster_views</span><span class="p">[</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">id_view_sheet</span><span class="p">(</span><span class="n">target</span><span class="p">)]</span> <span class="ow">is</span> <span class="n">target</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ApplicationWindow</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">patch</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="ow">is</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">g_app</span>

        <span class="n">headerbar</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">get_titlebar</span><span class="p">()</span>
        <span class="n">title_window</span> <span class="o">=</span> <span class="n">headerbar</span><span class="o">.</span><span class="n">get_custom_title</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">title_window</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">title_window</span><span class="o">.</span><span class="n">get_selectable</span><span class="p">()</span>
        <span class="n">title_window_str</span> <span class="o">=</span> <span class="n">title_window</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
        <span class="n">target_name</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">_control</span><span class="o">.</span><span class="n">name</span>
        <span class="k">assert</span> <span class="n">target_name</span> <span class="o">==</span> <span class="n">title_window_str</span>

        <span class="c1"># Components</span>
        <span class="c1"># assert isinstance(target._context_name, Gtk.Popover)</span>
        <span class="c1"># assert isinstance(target._context_summary, Gtk.Expander)</span>
        <span class="c1"># assert isinstance(target._flip_summary, Gtk.CheckButton)</span>
        <span class="c1"># assert isinstance(</span>
        <span class="c1">#     target._view_topics, ABC_OUTLINE.AbstractViewOutline)</span>
        <span class="c1"># assert target._view_topics.scope_search is ~ASHEET.FieldsTopic.VOID</span>
        <span class="c1"># assert target._view_topics.gtk_view.get_reorderable()</span>
        <span class="c1"># assert target._view_topics.gtk_view.get_parent() is not None</span>
        <span class="c1"># assert isinstance(target._cursor_topics, Gtk.TreeSelection)</span>
        <span class="c1"># assert isinstance(target._scenes_topic, VSCENES.Scenes)</span>
        <span class="c1"># assert isinstance(target._dialog_data_loss, Gtk.Dialog)</span>
        <span class="c1"># assert target._query_place is None</span>
        <span class="c1"># assert target._query_template is None</span>
        <span class="c1"># assert target._name_former is None</span>
        <span class="c1"># assert isinstance(target._warning_data_loss, Gtk.Label)</span>
        <span class="c1">#</span>
        <span class="c1"># # Identification Information</span>
        <span class="c1"># assert isinstance(target._infoid, VINFOID.ViewInfoId)</span>
        <span class="c1"># assert target._infoid.name is not None</span>
        <span class="c1"># assert target._infoid.summary is not None</span>
        <span class="c1"># assert target._infoid.title is not None</span>
        <span class="c1">#</span>
        <span class="c1"># # Application Title</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">lookup_action</span><span class="p">(</span><span class="s1">&#39;open-sheet&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">lookup_action</span><span class="p">(</span><span class="s1">&#39;new-sheet&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">lookup_action</span><span class="p">(</span><span class="s1">&#39;save-sheet&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">lookup_action</span><span class="p">(</span><span class="s1">&#39;save-as-sheet&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="c1">#</span>
        <span class="c1"># # Factsheet Menu</span>
        <span class="c1"># assert target._window.lookup_action(&#39;show-help-sheet&#39;) is not None</span>
        <span class="c1">#</span>
        <span class="c1"># # Factsheet Display Menu</span>
        <span class="c1"># assert target._window.lookup_action(&#39;flip-summary&#39;) is not None</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">lookup_action</span><span class="p">(</span><span class="s1">&#39;open-view-sheet&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">lookup_action</span><span class="p">(</span><span class="s1">&#39;close-view-sheet&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="c1"># assert target._window.lookup_action(</span>
        <span class="c1">#     &#39;show-help-sheet-display&#39;) is not None</span>
        <span class="c1">#</span>
        <span class="c1"># # Factsheet File Menu</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">lookup_action</span><span class="p">(</span><span class="s1">&#39;delete-sheet&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="c1"># assert target._window.lookup_action(</span>
        <span class="c1">#     &#39;show-help-sheet-file&#39;) is not None</span>
        <span class="c1">#</span>
        <span class="c1"># # Topics Outline Toolbar and Menu</span>
        <span class="c1"># assert target._view_topics.gtk_view.get_search_entry() is not None</span>
        <span class="c1"># assert target._window.lookup_action(&#39;new-topic&#39;) is not None</span>
        <span class="c1"># assert target._window.lookup_action(&#39;go-first-topic&#39;) is not None</span>
        <span class="c1"># assert target._window.lookup_action(&#39;go-last-topic&#39;) is not None</span>
        <span class="c1"># assert target._window.lookup_action(&#39;delete-topic&#39;) is not None</span>
        <span class="c1"># assert target._window.lookup_action(&#39;clear-topics&#39;) is not None</span>
        <span class="c1"># assert target._window.lookup_action(&#39;show-help-topics&#39;) is not None</span>
        <span class="c1">#</span>
        <span class="c1"># assert not target._close_window</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">is_visible</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_init_helpers"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_init_helpers">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;NAME_HELPER&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;_init_name_sheet&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_init_summary_sheet&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_init_title_sheet&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_init_topics&#39;</span><span class="p">,</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_init_helpers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NAME_HELPER</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">patch_set_app</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm initialization.</span>
<span class="sd">        | Case: helper function calls.</span>

<span class="sd">        :param NAME_HELPER: name of helper under test.</span>
<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param patch_set_app: fixture :func:`.patch_set_app`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchHelper</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_get</span> <span class="o">=</span> <span class="s1">&#39;Oops&#39;</span>

            <span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_get_object</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_get</span> <span class="o">=</span> <span class="n">p_get_object</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="n">patch_helper</span> <span class="o">=</span> <span class="n">PatchHelper</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">,</span> <span class="n">NAME_HELPER</span><span class="p">,</span> <span class="n">patch_helper</span><span class="o">.</span><span class="n">helper</span><span class="p">)</span>

        <span class="n">patch</span> <span class="o">=</span> <span class="n">patch_set_app</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">NAME_GET</span> <span class="o">=</span> <span class="s1">&#39;get_object&#39;</span>
        <span class="c1"># Test</span>
        <span class="n">_target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">patch_helper</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">NAME_GET</span> <span class="o">==</span> <span class="n">patch_helper</span><span class="o">.</span><span class="n">name_get</span></div>

<div class="viewcode-block" id="TestViewSheet.test_init_app_menu"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_init_app_menu">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;ACTION&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;show-about-app&#39;</span><span class="p">,</span>
        <span class="s1">&#39;show-help-app&#39;</span><span class="p">,</span>
        <span class="s1">&#39;show-intro-app&#39;</span><span class="p">,</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_init_app_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ACTION</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm initialization.</span>
<span class="sd">        | Case: definition of app menu actions</span>

<span class="sd">        :param ACTION: name of action to show menu item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">lookup_action</span><span class="p">(</span><span class="n">ACTION</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TestViewSheet.test_init_factsheet_menu"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_init_factsheet_menu">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;ACTION&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;show-help-sheet&#39;</span><span class="p">,</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_init_factsheet_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ACTION</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm initialization.</span>
<span class="sd">        | Case: definition of factsheet menu actions</span>

<span class="sd">        :param ACTION: name of action to show menu item.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">lookup_action</span><span class="p">(</span><span class="n">ACTION</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TestViewSheet.test_helper_init_topics"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_helper_init_topics">[docs]</a>    <span class="k">def</span> <span class="nf">test_helper_init_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm helper creates topics editor in sheet view.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchGetObject</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="s1">&#39;Oops&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui_view</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_ui</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">p_ui</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui_view</span>

        <span class="n">patch_get_object</span> <span class="o">=</span> <span class="n">PatchGetObject</span><span class="p">()</span>

        <span class="k">class</span> <span class="nc">PatchSite</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui_view</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expand_okay</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fill_okay</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_padding</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">def</span> <span class="nf">pack_start</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">p_view</span><span class="p">,</span> <span class="n">p_exapnd_okay</span><span class="p">,</span> <span class="n">p_fill_okay</span><span class="p">,</span> <span class="n">p_n_padding</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui_view</span> <span class="o">=</span> <span class="n">p_view</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expand_okay</span> <span class="o">=</span> <span class="n">p_exapnd_okay</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fill_okay</span> <span class="o">=</span> <span class="n">p_fill_okay</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_padding</span> <span class="o">=</span> <span class="n">p_n_padding</span>

        <span class="n">patch_site</span> <span class="o">=</span> <span class="n">PatchSite</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">,</span> <span class="s1">&#39;pack_start&#39;</span><span class="p">,</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">pack_start</span><span class="p">)</span>

        <span class="n">SITE_UI</span> <span class="o">=</span> <span class="s1">&#39;ui_site_topics&#39;</span>
        <span class="n">EXPAND_OKAY</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">FILL_OKAY</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">N_PADDING</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">patch_site</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">_init_topics</span><span class="p">(</span><span class="n">patch_get_object</span><span class="o">.</span><span class="n">get_object</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_get_object</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">SITE_UI</span> <span class="o">==</span> <span class="n">patch_get_object</span><span class="o">.</span><span class="n">ui</span>
        <span class="k">assert</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch_site</span><span class="o">.</span><span class="n">ui_view</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Frame</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">EXPAND_OKAY</span> <span class="o">==</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">expand_okay</span>
        <span class="k">assert</span> <span class="n">FILL_OKAY</span> <span class="o">==</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">fill_okay</span>
        <span class="k">assert</span> <span class="n">N_PADDING</span> <span class="o">==</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">n_padding</span></div>

<div class="viewcode-block" id="TestViewSheet.test_helper_init_summary"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_helper_init_summary">[docs]</a>    <span class="k">def</span> <span class="nf">test_helper_init_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm helper creates summary field in sheet view.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchGetObject</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_ui</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_ui</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">()</span>

        <span class="n">patch_get_object</span> <span class="o">=</span> <span class="n">PatchGetObject</span><span class="p">()</span>

        <span class="k">class</span> <span class="nc">PatchBind</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop_source</span> <span class="o">=</span> <span class="s1">&#39;Oops!&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop_target</span> <span class="o">=</span> <span class="s1">&#39;Oops!&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">def</span> <span class="nf">bind_property</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">p_prop_source</span><span class="p">,</span> <span class="n">p_target</span><span class="p">,</span> <span class="n">p_prop_target</span><span class="p">,</span> <span class="n">p_flags</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop_source</span> <span class="o">=</span> <span class="n">p_prop_source</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">p_target</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prop_target</span> <span class="o">=</span> <span class="n">p_prop_target</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">p_flags</span>

        <span class="n">patch_bind</span> <span class="o">=</span> <span class="n">PatchBind</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">,</span> <span class="s1">&#39;bind_property&#39;</span><span class="p">,</span> <span class="n">patch_bind</span><span class="o">.</span><span class="n">bind_property</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">PatchSite</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_view</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">view</span> <span class="o">=</span> <span class="n">p_view</span>

        <span class="n">patch_site</span> <span class="o">=</span> <span class="n">PatchSite</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>

        <span class="n">SITE_UI</span> <span class="o">=</span> <span class="s1">&#39;ui_site_summary_sheet&#39;</span>
        <span class="n">BUTTON_SHOW_UI</span> <span class="o">=</span> <span class="s1">&#39;ui_button_show_summary_sheet&#39;</span>
        <span class="n">PROP_BUTTON_SHOW</span> <span class="o">=</span> <span class="s1">&#39;active&#39;</span>
        <span class="n">EXPANDER_UI</span> <span class="o">=</span> <span class="s1">&#39;ui_expander_summary_sheet&#39;</span>
        <span class="n">PROP_EXPANDER</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
        <span class="n">FLAGS</span> <span class="o">=</span> <span class="n">GO</span><span class="o">.</span><span class="n">BindingFlags</span><span class="o">.</span><span class="n">BIDIRECTIONAL</span> <span class="o">|</span> <span class="n">GO</span><span class="o">.</span><span class="n">BindingFlags</span><span class="o">.</span><span class="n">SYNC_CREATE</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">_init_summary_sheet</span><span class="p">(</span><span class="n">patch_get_object</span><span class="o">.</span><span class="n">get_object</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_get_object</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">SITE_UI</span> <span class="ow">in</span> <span class="n">patch_get_object</span><span class="o">.</span><span class="n">ui</span>
        <span class="k">assert</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch_site</span><span class="o">.</span><span class="n">view</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">TextView</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">BUTTON_SHOW_UI</span> <span class="ow">in</span> <span class="n">patch_get_object</span><span class="o">.</span><span class="n">ui</span>
        <span class="k">assert</span> <span class="n">EXPANDER_UI</span> <span class="ow">in</span> <span class="n">patch_get_object</span><span class="o">.</span><span class="n">ui</span>
        <span class="k">assert</span> <span class="n">PROP_BUTTON_SHOW</span> <span class="o">==</span> <span class="n">patch_bind</span><span class="o">.</span><span class="n">prop_source</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch_bind</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">PROP_EXPANDER</span> <span class="o">==</span> <span class="n">patch_bind</span><span class="o">.</span><span class="n">prop_target</span>
        <span class="k">assert</span> <span class="n">FLAGS</span> <span class="o">==</span> <span class="n">patch_bind</span><span class="o">.</span><span class="n">flags</span></div>

<div class="viewcode-block" id="TestViewSheet.test_helper_init_view"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_helper_init_view">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;HELPER, CONTENT, SITE&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;_init_name_sheet&#39;</span><span class="p">,</span> <span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;ui_site_name_sheet&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;_init_title_sheet&#39;</span><span class="p">,</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;ui_site_title_sheet&#39;</span><span class="p">),</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_helper_init_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">HELPER</span><span class="p">,</span> <span class="n">CONTENT</span><span class="p">,</span> <span class="n">SITE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm helper creates name and title fields in sheet view.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param HELPER: initialization helper method under test.</span>
<span class="sd">        :param CONTENT: name of view type.</span>
<span class="sd">        :param SITE: expected locaton for new view.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchGetObject</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">site_ui</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_site_ui</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">site_ui</span> <span class="o">=</span> <span class="n">p_site_ui</span>
                <span class="k">return</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">()</span>

        <span class="n">patch_get_object</span> <span class="o">=</span> <span class="n">PatchGetObject</span><span class="p">()</span>

        <span class="k">class</span> <span class="nc">PatchViewEditor</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="s1">&#39;Oops&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui_view</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_display</span><span class="p">,</span> <span class="n">p_editor</span><span class="p">,</span> <span class="n">p_type</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">p_display</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">p_editor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">p_type</span>

        <span class="n">patch_view</span> <span class="o">=</span> <span class="n">PatchViewEditor</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">VSHEET</span><span class="o">.</span><span class="n">VMARKUP</span><span class="o">.</span><span class="n">ViewMarkup</span><span class="p">,</span> <span class="s1">&#39;__init__&#39;</span><span class="p">,</span> <span class="n">patch_view</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">VSHEET</span><span class="o">.</span><span class="n">VMARKUP</span><span class="o">.</span><span class="n">ViewMarkup</span><span class="p">,</span> <span class="s1">&#39;ui_view&#39;</span><span class="p">,</span> <span class="n">patch_view</span><span class="o">.</span><span class="n">ui_view</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">PatchSite</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui_view</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expand_okay</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fill_okay</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_padding</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">def</span> <span class="nf">pack_start</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">p_view</span><span class="p">,</span> <span class="n">p_exapnd_okay</span><span class="p">,</span> <span class="n">p_fill_okay</span><span class="p">,</span> <span class="n">p_n_padding</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui_view</span> <span class="o">=</span> <span class="n">p_view</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expand_okay</span> <span class="o">=</span> <span class="n">p_exapnd_okay</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fill_okay</span> <span class="o">=</span> <span class="n">p_fill_okay</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_padding</span> <span class="o">=</span> <span class="n">p_n_padding</span>

        <span class="n">patch_site</span> <span class="o">=</span> <span class="n">PatchSite</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Box</span><span class="p">,</span> <span class="s1">&#39;pack_start&#39;</span><span class="p">,</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">pack_start</span><span class="p">)</span>

        <span class="n">EXPAND_OKAY</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">FILL_OKAY</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">N_PADDING</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">view_sheet</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">patch_site</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># Test</span>
        <span class="n">target</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">view_sheet</span><span class="p">,</span> <span class="n">HELPER</span><span class="p">)</span>
        <span class="n">target</span><span class="p">(</span><span class="n">patch_get_object</span><span class="o">.</span><span class="n">get_object</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_view</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch_view</span><span class="o">.</span><span class="n">editor</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Entry</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch_view</span><span class="o">.</span><span class="n">display</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Label</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">CONTENT</span> <span class="o">==</span> <span class="n">patch_view</span><span class="o">.</span><span class="n">content</span>
        <span class="k">assert</span> <span class="n">patch_get_object</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">SITE</span> <span class="o">==</span> <span class="n">patch_get_object</span><span class="o">.</span><span class="n">site_ui</span>
        <span class="k">assert</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">patch_view</span><span class="o">.</span><span class="n">ui_view</span> <span class="ow">is</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">ui_view</span>
        <span class="k">assert</span> <span class="n">EXPAND_OKAY</span> <span class="o">==</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">expand_okay</span>
        <span class="k">assert</span> <span class="n">FILL_OKAY</span> <span class="o">==</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">fill_okay</span>
        <span class="k">assert</span> <span class="n">N_PADDING</span> <span class="o">==</span> <span class="n">patch_site</span><span class="o">.</span><span class="n">n_padding</span></div>

<div class="viewcode-block" id="TestViewSheet.test_init_signals"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_init_signals">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
        <span class="s1">&#39;NAME_SIGNAL, NAME_ATTRIBUTE, ORIGIN, N_DEFAULT&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="c1"># (&#39;closed&#39;, &#39;_context_name&#39;, Gtk.Popover, 0),</span>
            <span class="p">(</span><span class="s1">&#39;delete-event&#39;</span><span class="p">,</span> <span class="s1">&#39;_window&#39;</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ApplicationWindow</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="c1"># (&#39;changed&#39;, &#39;_cursor_topics&#39;, Gtk.TreeSelection, 0),</span>
            <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_init_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NAME_SIGNAL</span><span class="p">,</span> <span class="n">NAME_ATTRIBUTE</span><span class="p">,</span> <span class="n">ORIGIN</span><span class="p">,</span>
                          <span class="n">N_DEFAULT</span><span class="p">,</span> <span class="n">gtk_app_window</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm initialization.</span>
<span class="sd">        | Case: signal connections</span>

<span class="sd">        :param NAME_SIGNAL: name of signal.</span>
<span class="sd">        :param NAME_ATTRIBUTE: name of attribute connected to signal.</span>
<span class="sd">        :param ORIGIN: GTK class of connected attribute.</span>
<span class="sd">        :param N_DEFAULT: number of default handlers</span>
<span class="sd">        :param gtk_app_window: fixture :func:`.gtk_app_window`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">origin_gtype</span> <span class="o">=</span> <span class="n">GO</span><span class="o">.</span><span class="n">type_from_name</span><span class="p">(</span><span class="n">GO</span><span class="o">.</span><span class="n">type_name</span><span class="p">(</span><span class="n">ORIGIN</span><span class="p">))</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="n">GO</span><span class="o">.</span><span class="n">signal_lookup</span><span class="p">(</span><span class="n">NAME_SIGNAL</span><span class="p">,</span> <span class="n">origin_gtype</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="c1"># # target._window.set_skip_pager_hint(True)</span>
        <span class="c1"># # target._window.set_skip_taskbar_hint(True)</span>
        <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">set_transient_for</span><span class="p">(</span><span class="n">gtk_app_window</span><span class="p">)</span>

        <span class="n">attribute</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">NAME_ATTRIBUTE</span><span class="p">)</span>
        <span class="n">n_handlers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">id_signal</span> <span class="o">=</span> <span class="n">GO</span><span class="o">.</span><span class="n">signal_handler_find</span><span class="p">(</span>
                <span class="n">attribute</span><span class="p">,</span> <span class="n">GO</span><span class="o">.</span><span class="n">SignalMatchType</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">id_signal</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">n_handlers</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">GO</span><span class="o">.</span><span class="n">signal_handler_disconnect</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">id_signal</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">N_DEFAULT</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">n_handlers</span></div>

<div class="viewcode-block" id="TestViewSheet.test_confirm_close"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_confirm_close">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;RESPONSE, RETURN&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">APPLY</span><span class="p">,</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="o">.</span><span class="n">ALLOW_CLOSE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="o">.</span><span class="n">DENY_CLOSE</span><span class="p">)</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_confirm_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">RESPONSE</span><span class="p">,</span> <span class="n">RETURN</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm translation of GTK response types.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Dialog</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_s</span><span class="p">:</span> <span class="n">RESPONSE</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="k">assert</span> <span class="n">RETURN</span> <span class="o">==</span> <span class="n">target</span><span class="o">.</span><span class="n">confirm_close</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_erases"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_erases">[docs]</a>    <span class="k">def</span> <span class="nf">test_erases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm view destroys its visual element.&quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchDestroy</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">patch_destroy</span> <span class="o">=</span> <span class="n">PatchDestroy</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span> <span class="n">patch_destroy</span><span class="o">.</span><span class="n">destroy</span><span class="p">)</span>

        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">erase</span><span class="p">()</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">patch_destroy</span><span class="o">.</span><span class="n">called</span></div>

<div class="viewcode-block" id="TestViewSheet.test_get_path"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_get_path">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
        <span class="s1">&#39;NAME_ACT, IS_SET, GET_FILE, SET_CURRENT, SET_FILE&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)),</span>
            <span class="p">(</span><span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">marks</span><span class="o">=</span><span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">dialog_choose</span><span class="p">(</span>
                              <span class="n">suggest</span><span class="o">=</span><span class="s1">&#39;saved.fsg&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="kc">None</span><span class="p">))),</span>
            <span class="p">(</span><span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">marks</span><span class="o">=</span><span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">dialog_choose</span><span class="p">(</span>
                              <span class="n">suggest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">response</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">))),</span>
            <span class="p">(</span><span class="n">pytest</span><span class="o">.</span><span class="n">param</span><span class="p">(</span><span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">marks</span><span class="o">=</span><span class="n">pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">dialog_choose</span><span class="p">(</span>
                              <span class="n">suggest</span><span class="o">=</span><span class="s2">&quot;saved.fsg&quot;</span><span class="p">,</span>
                              <span class="n">response</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">APPLY</span><span class="p">))),</span>
            <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_dialog_choose</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">,</span>
                      <span class="n">NAME_ACT</span><span class="p">,</span> <span class="n">IS_SET</span><span class="p">,</span> <span class="n">GET_FILE</span><span class="p">,</span> <span class="n">SET_CURRENT</span><span class="p">,</span> <span class="n">SET_FILE</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm save to file.</span>
<span class="sd">        | Case: file path defined.</span>

<span class="sd">        :param patch_dialog_choose: fixture :func:`.patch_dialog_choose`.</span>
<span class="sd">        :param tmp_path: built-in fixture `Pytest tmp_path`_.</span>
<span class="sd">        :param NAME_ACT: name of dialog box action (Open, Save, etc.).</span>
<span class="sd">        :param IS_SET: True when return value should not be None.</span>
<span class="sd">        :param GET_FILE: True when method should use path from dialog.</span>
<span class="sd">        :param SET_CURRENT: True when method should suggest default file</span>
<span class="sd">            name.</span>
<span class="sd">        :param SET_FILE: True when method should suggest file name from</span>
<span class="sd">            parameter mark.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">patch_dialog_choose</span>
        <span class="n">path_suggest</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">path_suggest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path_suggest</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmp_path</span> <span class="o">/</span> <span class="n">dialog</span><span class="o">.</span><span class="n">path_suggest</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">ACTIONS</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">save</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">SAVE</span><span class="p">,</span>
            <span class="nb">open</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
            <span class="n">create</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">CREATE_FOLDER</span><span class="p">,</span>
            <span class="n">select</span><span class="o">=</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">SELECT_FOLDER</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">ACTIONS</span><span class="p">[</span><span class="n">NAME_ACT</span><span class="p">]</span>
        <span class="c1"># Test</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">p_action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">p_suggest</span><span class="o">=</span><span class="n">path_suggest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">IS_SET</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">path_suggest</span><span class="p">)</span> <span class="o">==</span> <span class="n">dialog</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">called_get_filename</span> <span class="ow">is</span> <span class="n">GET_FILE</span>
        <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">called_hide</span>
        <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">called_run</span>
        <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">called_set_current_name</span> <span class="ow">is</span> <span class="n">SET_CURRENT</span>
        <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">called_set_filename</span> <span class="ow">is</span> <span class="n">SET_FILE</span></div>

<div class="viewcode-block" id="TestViewSheet.test_get_path_action"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_get_path_action">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;ACTION&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
        <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">SAVE</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_get_path_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">ACTION</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm file chooser dialog consistent with action.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param ACTION: action for file chooser dialog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchDialog</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">def</span> <span class="nf">_make_file_chooser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_action</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">p_action</span>
                <span class="k">raise</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">FactsheetError</span><span class="p">(</span><span class="s1">&#39;Oops!&#39;</span><span class="p">)</span>

        <span class="n">patch_dialog</span> <span class="o">=</span> <span class="n">PatchDialog</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">,</span> <span class="s1">&#39;_make_file_chooser&#39;</span><span class="p">,</span>
                            <span class="n">patch_dialog</span><span class="o">.</span><span class="n">_make_file_chooser</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">FactsheetError</span><span class="p">):</span>
            <span class="n">_path</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">p_action</span><span class="o">=</span><span class="n">ACTION</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ACTION</span> <span class="o">==</span> <span class="n">patch_dialog</span><span class="o">.</span><span class="n">action</span></div>

<div class="viewcode-block" id="TestViewSheet.test_make_dialog_file"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_make_dialog_file">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;ACTION, LABEL&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">SAVE</span><span class="p">,</span> <span class="s1">&#39;Save&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span> <span class="s1">&#39;Open&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">SELECT_FOLDER</span><span class="p">,</span> <span class="s1">&#39;Select&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">CREATE_FOLDER</span><span class="p">,</span> <span class="s1">&#39;Create&#39;</span><span class="p">),</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_make_dialog_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ACTION</span><span class="p">,</span> <span class="n">LABEL</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm construction of dialog for file save and open.</span>

<span class="sd">        :param ACTION: dialog box action (Open or Save)</span>
<span class="sd">        :param LABEL: response button label</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">set_skip_taskbar_hint</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">FILTERS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Factsheet&#39;</span><span class="p">,</span> <span class="s1">&#39;Any&#39;</span><span class="p">])</span>
        <span class="c1"># Test</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">_make_file_chooser</span><span class="p">(</span><span class="n">ACTION</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dialog</span><span class="p">,</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserDialog</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_action</span><span class="p">()</span> <span class="ow">is</span> <span class="n">ACTION</span>
        <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_transient_for</span><span class="p">()</span> <span class="ow">is</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span>
        <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_destroy_with_parent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ACTION</span> <span class="ow">is</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">FileChooserAction</span><span class="o">.</span><span class="n">SAVE</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_do_overwrite_confirmation</span><span class="p">()</span>

        <span class="n">button</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_for_response</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s1">&#39;Cancel&#39;</span> <span class="o">==</span> <span class="n">button</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>

        <span class="n">button</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_widget_for_response</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">APPLY</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">LABEL</span> <span class="o">==</span> <span class="n">button</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="n">get_style_context</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">style</span><span class="o">.</span><span class="n">has_class</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">STYLE_CLASS_SUGGESTED_ACTION</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">FILTERS</span> <span class="o">==</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dialog</span><span class="o">.</span><span class="n">list_filters</span><span class="p">()}</span></div>

    <span class="c1"># def test_new_view_topics(self, patch_factsheet, capfd):</span>
    <span class="c1">#     &quot;&quot;&quot; &quot;&quot;&quot;</span>
    <span class="c1">#     # Setup</span>
    <span class="c1">#     factsheet = patch_factsheet()</span>
    <span class="c1">#     target = VSHEET.ViewSheet(px_app=factsheet)</span>
    <span class="c1">#     snapshot = capfd.readouterr()   # Resets the internal buffer</span>
    <span class="c1">#     assert not snapshot.out</span>
    <span class="c1">#     assert &#39;Gtk-CRITICAL&#39; in snapshot.err</span>
    <span class="c1">#     assert &#39;GApplication::startup signal&#39; in snapshot.err</span>
    <span class="c1">#     # target._window.set_skip_pager_hint(True)</span>
    <span class="c1">#     # target._window.set_skip_taskbar_hint(True)</span>
    <span class="c1">#     target._window.set_transient_for(WINDOW_ANCHOR)</span>
    <span class="c1">#     sheets_active = CPOOL.PoolSheets()</span>
    <span class="c1">#     control = CSHEET.ControlSheet.new(sheets_active)</span>
    <span class="c1">#     target.link_factsheet(target, control)</span>

    <span class="c1">#     # Test</span>
    <span class="c1">#     view_new = target.new_view_topics()</span>
    <span class="c1">#     assert isinstance(view_new, VTYPES.ViewOutlineTopics)</span>
    <span class="c1">#     model = target._view_topics.gtk_view.get_model()</span>
    <span class="c1">#     assert view_new.gtk_view.get_model() is model</span>
    <span class="c1">#     # Teardown</span>

<div class="viewcode-block" id="TestViewSheet.test_on_close_view_sheet_safe"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_close_view_sheet_safe">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_close_view_sheet_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm attempt to close view.</span>
<span class="sd">        | Case: no loss of unsaved changes</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchIsSafe</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_is_safe</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_safe</span> <span class="o">=</span> <span class="n">p_is_safe</span>

            <span class="k">def</span> <span class="nf">remove_view_is_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe</span>

        <span class="n">patch_safe</span> <span class="o">=</span> <span class="n">PatchIsSafe</span><span class="p">(</span><span class="n">p_is_safe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">,</span> <span class="s1">&#39;remove_view_is_safe&#39;</span><span class="p">,</span>
                            <span class="n">patch_safe</span><span class="o">.</span><span class="n">remove_view_is_safe</span><span class="p">)</span>

        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">id_target</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">id_view_sheet</span><span class="p">(</span><span class="n">p_view_sheet</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="n">view_new</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">roster_views</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">_roster_views</span>
        <span class="n">N_VIEWS</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Test</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">on_close_view_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_safe</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="o">.</span><span class="n">ALLOW_CLOSE</span> <span class="o">==</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="n">N_VIEWS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">roster_views</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">id_target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">roster_views</span>
        <span class="c1"># Teardown</span>
        <span class="n">view_new</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_close_view_sheet_unsafe_allow"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_close_view_sheet_unsafe_allow">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_close_view_sheet_unsafe_allow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm attempt to close view.</span>
<span class="sd">        | Case: user allows loss of unsaved changes</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchIsSafe</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_is_safe</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_safe</span> <span class="o">=</span> <span class="n">p_is_safe</span>

            <span class="k">def</span> <span class="nf">remove_view_is_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe</span>

        <span class="n">patch_unsafe</span> <span class="o">=</span> <span class="n">PatchIsSafe</span><span class="p">(</span><span class="n">p_is_safe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">,</span> <span class="s1">&#39;remove_view_is_safe&#39;</span><span class="p">,</span>
                            <span class="n">patch_unsafe</span><span class="o">.</span><span class="n">remove_view_is_safe</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">Gtk</span><span class="o">.</span><span class="n">Dialog</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_s</span><span class="p">:</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">APPLY</span><span class="p">)</span>

        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">id_target</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">id_view_sheet</span><span class="p">(</span><span class="n">p_view_sheet</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="n">view_new</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">roster_views</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">_roster_views</span>
        <span class="n">N_VIEWS</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Test</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">on_close_view_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_unsafe</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="o">.</span><span class="n">ALLOW_CLOSE</span> <span class="o">==</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="n">N_VIEWS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">roster_views</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">id_target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">roster_views</span>
        <span class="c1"># Teardown</span>
        <span class="n">view_new</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_close_view_sheet_unsafe_deny"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_close_view_sheet_unsafe_deny">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_close_view_sheet_unsafe_deny</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm attempt to close view.</span>
<span class="sd">        | Case: user denies loss of unsaved changes</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchIsSafe</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_is_safe</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_safe</span> <span class="o">=</span> <span class="n">p_is_safe</span>

            <span class="k">def</span> <span class="nf">remove_view_is_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe</span>

        <span class="n">patch_unsafe</span> <span class="o">=</span> <span class="n">PatchIsSafe</span><span class="p">(</span><span class="n">p_is_safe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">,</span> <span class="s1">&#39;remove_view_is_safe&#39;</span><span class="p">,</span>
                            <span class="n">patch_unsafe</span><span class="o">.</span><span class="n">remove_view_is_safe</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">Gtk</span><span class="o">.</span><span class="n">Dialog</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_s</span><span class="p">:</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>

        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">view_new</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">id_view_new</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">id_view_sheet</span><span class="p">(</span><span class="n">p_view_sheet</span><span class="o">=</span><span class="n">view_new</span><span class="p">)</span>
        <span class="n">roster_views</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">_roster_views</span>
        <span class="n">N_VIEWS</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="c1"># Test</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">on_close_view_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_unsafe</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="o">.</span><span class="n">DENY_CLOSE</span> <span class="o">==</span> <span class="n">result</span>
        <span class="k">assert</span> <span class="n">N_VIEWS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">roster_views</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">id_view_new</span> <span class="ow">in</span> <span class="n">roster_views</span>
        <span class="c1"># Teardown</span>
        <span class="n">view_new</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_delete_sheet_safe"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_delete_sheet_safe">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">is_stale</span><span class="p">(</span><span class="n">is_stale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_delete_sheet_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_is_stale</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm attempt to close factsheet.</span>
<span class="sd">        | Case: no loss of unsaved changes</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">id_control</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">tag</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_delete_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_is_stale</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">control</span><span class="o">.</span><span class="n">_roster_views</span>
        <span class="k">assert</span> <span class="n">id_control</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">_roster_sheets</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_delete_sheet_unsafe_allow"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_delete_sheet_unsafe_allow">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">is_stale</span><span class="p">(</span><span class="n">is_stale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_delete_sheet_unsafe_allow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_is_stale</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm attempt to close factsheet.</span>
<span class="sd">        | Case: user allows loss of unsaved changes</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">Gtk</span><span class="o">.</span><span class="n">Dialog</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_s</span><span class="p">:</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">APPLY</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">id_control</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">tag</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_delete_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_is_stale</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">control</span><span class="o">.</span><span class="n">_roster_views</span>
        <span class="k">assert</span> <span class="n">id_control</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">_roster_sheets</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_delete_sheet_unsafe_deny"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_delete_sheet_unsafe_deny">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">is_stale</span><span class="p">(</span><span class="n">is_stale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_delete_sheet_unsafe_deny</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_is_stale</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm attempt to close factsheet.</span>
<span class="sd">        | Case: user denies loss of unsaved changes</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">Gtk</span><span class="o">.</span><span class="n">Dialog</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_s</span><span class="p">:</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">ResponseType</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">id_control</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">tag</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">id_target</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">id_view_sheet</span><span class="p">(</span><span class="n">p_view_sheet</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_delete_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_is_stale</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">control</span><span class="o">.</span><span class="n">_roster_views</span><span class="p">[</span><span class="n">id_target</span><span class="p">]</span> <span class="ow">is</span> <span class="n">target</span>
        <span class="k">assert</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="p">[</span><span class="n">id_control</span><span class="p">]</span> <span class="ow">is</span> <span class="n">control</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_new_sheet"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_new_sheet">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_new_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm factsheet creation with initial window.</span>
<span class="sd">        | Case: creation succeeds</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="s1">&#39;show_all&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_s</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">control_app</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span>
        <span class="n">N_SHEETS</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">N_VIEWS</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Test</span>
        <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="o">.</span><span class="n">on_new_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">N_SHEETS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="p">)</span>
        <span class="n">_key</span><span class="p">,</span> <span class="n">control_sheet</span> <span class="o">=</span> <span class="n">control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">N_VIEWS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">control_sheet</span><span class="o">.</span><span class="n">_roster_views</span><span class="p">)</span>
        <span class="n">_key</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="n">control_sheet</span><span class="o">.</span><span class="n">_roster_views</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">view</span><span class="o">.</span><span class="n">_control</span> <span class="ow">is</span> <span class="n">control_sheet</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_new_sheet_fail"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_new_sheet_fail">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_new_sheet_fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">caplog</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm factsheet creation with initial window.</span>
<span class="sd">        | Case: creation fails.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param caplog: built-in fixture `Pytest caplog`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="s1">&#39;show_all&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_s</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlApp</span><span class="p">,</span> <span class="s1">&#39;open_factsheet&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_c</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">N_LOGS</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">LAST</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">log_message</span> <span class="o">=</span> <span class="s1">&#39;Failed to create new factsheet (ViewSheet.on_new_sheet)&#39;</span>
        <span class="c1"># Test</span>
        <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="o">.</span><span class="n">on_new_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">N_LOGS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">LAST</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">log_message</span> <span class="o">==</span> <span class="n">record</span><span class="o">.</span><span class="n">message</span>
        <span class="k">assert</span> <span class="s1">&#39;CRITICAL&#39;</span> <span class="o">==</span> <span class="n">record</span><span class="o">.</span><span class="n">levelname</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_open_sheet"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_open_sheet">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_open_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">patch_get_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm open from file.</span>
<span class="sd">        | Case: open file not in collection of open factsheets.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param patch_get_path: fixture :func:`.patch_get_path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchOpenFactsheet</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">def</span> <span class="nf">open_factsheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_path</span><span class="p">,</span> <span class="n">p_time</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">p_time</span>
                <span class="n">sheet</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">(</span><span class="n">p_path</span><span class="o">=</span><span class="n">p_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id_sheet</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">tag</span>
                <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id_sheet</span><span class="p">]</span> <span class="o">=</span> <span class="n">sheet</span>
                <span class="k">return</span> <span class="n">sheet</span>

        <span class="n">patch_open</span> <span class="o">=</span> <span class="n">PatchOpenFactsheet</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlApp</span><span class="p">,</span> <span class="s1">&#39;open_factsheet&#39;</span><span class="p">,</span> <span class="n">patch_open</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">(</span><span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">N_VIEWS</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_open_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_open</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span> <span class="o">==</span> <span class="n">patch_open</span><span class="o">.</span><span class="n">time</span>
        <span class="n">sheet</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="p">[</span><span class="n">patch_open</span><span class="o">.</span><span class="n">id_sheet</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">sheet</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="n">patch_get_path</span>
        <span class="k">assert</span> <span class="n">N_VIEWS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">_roster_views</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">_roster_views</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_open_sheet_cancel"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_open_sheet_cancel">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_open_sheet_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">patch_get_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm open from file.</span>
<span class="sd">        | Case: cancel open.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param patch_get_path: fixture :func:`.patch_get_path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchOpenFactsheet</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">def</span> <span class="nf">open_factsheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_path</span><span class="p">,</span> <span class="n">p_time</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">p_time</span>
                <span class="n">sheet</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">(</span><span class="n">p_path</span><span class="o">=</span><span class="n">p_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id_sheet</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">id_factsheet</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
                <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id_sheet</span><span class="p">]</span> <span class="o">=</span> <span class="n">sheet</span>
                <span class="k">return</span> <span class="n">sheet</span>

        <span class="n">patch_open</span> <span class="o">=</span> <span class="n">PatchOpenFactsheet</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlApp</span><span class="p">,</span> <span class="s1">&#39;open_factsheet&#39;</span><span class="p">,</span> <span class="n">patch_open</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">(</span><span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_open_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">patch_open</span><span class="o">.</span><span class="n">called</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_open_sheet_present"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_open_sheet_present">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_open_sheet_present</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">patch_get_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm open from file.</span>
<span class="sd">        | Case: present file already in collection of open factsheets.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param patch_get_path: fixture :func:`.patch_get_path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchOpenFactsheet</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">def</span> <span class="nf">open_factsheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_path</span><span class="p">,</span> <span class="n">p_time</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">p_time</span>
                <span class="n">sheet</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">(</span><span class="n">p_path</span><span class="o">=</span><span class="n">p_path</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id_sheet</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">tag</span>
                <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id_sheet</span><span class="p">]</span> <span class="o">=</span> <span class="n">sheet</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="n">patch_open</span> <span class="o">=</span> <span class="n">PatchOpenFactsheet</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span>
            <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlApp</span><span class="p">,</span> <span class="s1">&#39;open_factsheet&#39;</span><span class="p">,</span> <span class="n">patch_open</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">(</span><span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">N_VIEWS</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_open_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_open</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span> <span class="o">==</span> <span class="n">patch_open</span><span class="o">.</span><span class="n">time</span>
        <span class="n">sheet</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">_roster_sheets</span><span class="p">[</span><span class="n">patch_open</span><span class="o">.</span><span class="n">id_sheet</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">sheet</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="n">patch_get_path</span>
        <span class="k">assert</span> <span class="n">N_VIEWS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">_roster_views</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_open_view_sheet"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_open_view_sheet">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_open_view_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm view created and added to control.&quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">roster_views</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">_roster_views</span>
        <span class="n">N_VIEWS</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_open_view_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">N_VIEWS</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">roster_views</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">roster_views</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">id_view_sheet</span><span class="p">(</span><span class="n">p_view_sheet</span><span class="o">=</span><span class="n">target</span><span class="p">))</span>
        <span class="n">key_new</span><span class="p">,</span> <span class="n">view_new</span> <span class="o">=</span> <span class="n">roster_views</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">key_new</span> <span class="o">==</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">id_view_sheet</span><span class="p">(</span><span class="n">view_new</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">view_new</span><span class="p">,</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">view_new</span><span class="o">.</span><span class="n">_control</span> <span class="ow">is</span> <span class="n">control</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_save_as_sheet"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_save_as_sheet">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_save_as_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_get_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm file save with save as.</span>
<span class="sd">        | Case: user provides file path.</span>

<span class="sd">        :param patch_get_path: fixture :func:`.patch_get_path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">patch_get_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_save_as_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">control</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="n">patch_get_path</span>
        <span class="k">assert</span> <span class="n">control</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_save_as_sheet_cancel"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_save_as_sheet_cancel">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_save_as_sheet_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_get_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm file save with save as.</span>
<span class="sd">        | Case: user cancels save.</span>

<span class="sd">        :param patch_get_path: fixture :func:`.patch_get_path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_save_as_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>
        <span class="c1"># Successful call makes no state change.</span>

<div class="viewcode-block" id="TestViewSheet.test_on_save_sheet"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_save_sheet">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_save_sheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm file save.</span>
<span class="sd">        | Case: file path defined.</span>

<span class="sd">        :param tmp_path: built-in fixture `Pytest tmp_path`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmp_path</span> <span class="o">/</span> <span class="s1">&#39;saved_factsheet.fsg&#39;</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">control</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">PATH</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">control</span><span class="o">.</span><span class="n">_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_save_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">control</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_save_sheet_cancel"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_save_sheet_cancel">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_save_sheet_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_get_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm file save.</span>
<span class="sd">        | Case: no file path and user does not provide one.</span>

<span class="sd">        :param patch_get_path: fixture :func:`.patch_get_path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_save_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>
        <span class="c1"># Successful call makes no state change.</span>

<div class="viewcode-block" id="TestViewSheet.test_on_save_sheet_none"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_save_sheet_none">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="n">cancel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_on_save_sheet_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch_get_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm save to file.</span>
<span class="sd">        | Case: no file path and user provides one.</span>

<span class="sd">        :param patch_get_path: fixture :func:`.patch_get_path`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">patch_get_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_save_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_get_path</span> <span class="o">==</span> <span class="n">control</span><span class="o">.</span><span class="n">path</span>
        <span class="k">assert</span> <span class="n">control</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_show_dialog"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_show_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">test_on_show_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">gtk_app_window</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm handler displays dialog.</span>

<span class="sd">        See manual tests for dialog content checks.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param gtk_app_window: fixture :func:`.gtk_app_window`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>

        <span class="k">class</span> <span class="nc">PatchRun</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">called</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">patch</span> <span class="o">=</span> <span class="n">PatchRun</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">Dialog</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>

        <span class="n">dialog</span> <span class="o">=</span> <span class="n">Gtk</span><span class="o">.</span><span class="n">Dialog</span><span class="p">()</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">gtk_app_window</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">set_transient_for</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">on_show_dialog</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dialog</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_transient_for</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">patch</span><span class="o">.</span><span class="n">called</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">dialog</span><span class="o">.</span><span class="n">is_visible</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_on_toggle_search_field_inactive"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_toggle_search_field_inactive">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span>
    <span class="k">def</span> <span class="nf">test_on_toggle_search_field_inactive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">capfd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm search field set.</span>
<span class="sd">        | Case: button inactive.</span>

<span class="sd">        :param capfd: built-in fixture `Pytest capfd`_.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="c1"># # Setup</span>
        <span class="c1"># factsheet = patch_factsheet()</span>
        <span class="c1"># target_page = VSHEET.ViewSheet(px_app=factsheet)</span>
        <span class="c1"># snapshot = capfd.readouterr()   # Resets the internal buffer</span>
        <span class="c1"># assert not snapshot.out</span>
        <span class="c1"># assert &#39;Gtk-CRITICAL&#39; in snapshot.err</span>
        <span class="c1"># assert &#39;GApplication::startup signal&#39; in snapshot.err</span>
        <span class="c1"># # target_page._window.set_skip_pager_hint(True)</span>
        <span class="c1"># target_page._window.set_skip_taskbar_hint(True)</span>
        <span class="c1">#</span>
        <span class="c1"># target = target_page._view_topics</span>
        <span class="c1"># SEARCH_ALL = ~ASHEET.FieldsTopic.VOID</span>
        <span class="c1"># target.scope_search = SEARCH_ALL</span>
        <span class="c1"># button = Gtk.ToggleButton(active=False)</span>
        <span class="c1"># # Test</span>
        <span class="c1"># target_page.on_toggle_search_field(button, ASHEET.FieldsTopic.NAME)</span>
        <span class="c1"># assert not target.scope_search &amp; ASHEET.FieldsTopic.NAME</span>
        <span class="c1"># assert target.scope_search &amp; ASHEET.FieldsTopic.TITLE</span>
        <span class="c1"># # Teardown</span>
        <span class="c1"># target_page._window.destroy()</span>
        <span class="c1"># del target_page._window</span>
        <span class="c1"># del factsheet</span>

<div class="viewcode-block" id="TestViewSheet.test_on_toggle_search_field_active"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_on_toggle_search_field_active">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">skip</span>
    <span class="k">def</span> <span class="nf">test_on_toggle_search_field_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">capfd</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm search field set.</span>
<span class="sd">        | Case: button inactive.</span>

<span class="sd">        :param capfd: built-in fixture `Pytest capfd`_.</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
        <span class="c1"># # Setup</span>
        <span class="c1"># factsheet = patch_factsheet()</span>
        <span class="c1"># target_page = VSHEET.ViewSheet(px_app=factsheet)</span>
        <span class="c1"># snapshot = capfd.readouterr()   # Resets the internal buffer</span>
        <span class="c1"># assert not snapshot.out</span>
        <span class="c1"># assert &#39;Gtk-CRITICAL&#39; in snapshot.err</span>
        <span class="c1"># assert &#39;GApplication::startup signal&#39; in snapshot.err</span>
        <span class="c1"># # target_page._window.set_skip_pager_hint(True)</span>
        <span class="c1"># target_page._window.set_skip_taskbar_hint(True)</span>
        <span class="c1">#</span>
        <span class="c1"># target = target_page._view_topics</span>
        <span class="c1"># SEARCH_NONE = ASHEET.FieldsTopic.VOID</span>
        <span class="c1"># target.scope_search = SEARCH_NONE</span>
        <span class="c1"># button = Gtk.ToggleButton(active=True)</span>
        <span class="c1"># # Test - not active</span>
        <span class="c1"># target_page.on_toggle_search_field(button, ASHEET.FieldsTopic.TITLE)</span>
        <span class="c1"># assert target.scope_search &amp; ASHEET.FieldsTopic.TITLE</span>
        <span class="c1"># assert not target.scope_search &amp; ASHEET.FieldsTopic.NAME</span>
        <span class="c1"># # Teardown</span>
        <span class="c1"># target_page._window.destroy()</span>
        <span class="c1"># del target_page._window</span>
        <span class="c1"># del factsheet</span>

<div class="viewcode-block" id="TestViewSheet.test_present"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_present">[docs]</a>    <span class="k">def</span> <span class="nf">test_present</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm page becomes visible.&quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">present</span><span class="p">(</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">target</span><span class="o">.</span><span class="n">_window</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestViewSheet.test_property"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_property">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;NAME_ATTR, NAME_PROP&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;_window&#39;</span><span class="p">,</span> <span class="s1">&#39;window&#39;</span><span class="p">],</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NAME_ATTR</span><span class="p">,</span> <span class="n">NAME_PROP</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm properties are get-only.</span>

<span class="sd">        #. Case: get</span>
<span class="sd">        #. Case: no set</span>
<span class="sd">        #. Case: no delete</span>

<span class="sd">        :param NAME_ATTR: name of attribute.</span>
<span class="sd">        :param NAME_PROP: name of property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">value_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">NAME_ATTR</span><span class="p">)</span>
        <span class="n">target_prop</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">,</span> <span class="n">NAME_PROP</span><span class="p">)</span>
        <span class="n">value_prop</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">NAME_PROP</span><span class="p">)</span>
        <span class="c1"># Test: read</span>
        <span class="k">assert</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">fget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">value_attr</span> <span class="ow">is</span> <span class="n">value_prop</span>
        <span class="c1"># Test: no replace</span>
        <span class="k">assert</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">fset</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="c1"># Test: no delete</span>
        <span class="k">assert</span> <span class="n">target_prop</span><span class="o">.</span><span class="n">fdel</span> <span class="ow">is</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TestViewSheet.test_report_error_sheet"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_report_error_sheet">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;ERROR, CAUSE, TRACE, PRIME, SECOND&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">DumpFileError</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No its not.&#39;</span><span class="p">),</span>
         <span class="s1">&#39;Exception: No its not.&#39;</span><span class="p">,</span> <span class="s1">&#39;This parrot is dead!&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Error source is Exception: No its not.&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">NoFileError</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
         <span class="s1">&#39;Traceback (most recent call last):&#39;</span><span class="p">,</span> <span class="s1">&#39;It is a former parrot.&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Error source is Factsheet.&#39;</span><span class="p">)</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_report_error_sheet</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">ERROR</span><span class="p">,</span> <span class="n">CAUSE</span><span class="p">,</span> <span class="n">TRACE</span><span class="p">,</span> <span class="n">PRIME</span><span class="p">,</span> <span class="n">SECOND</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">caplog</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Confirm dialog and logging for exceptions during file save.</span>

<span class="sd">        :param ERROR: sheet error exception.</span>
<span class="sd">        :param CAUSE: system exception cause of sheet error.</span>
<span class="sd">        :param PRIME: primary text for error dialog.</span>
<span class="sd">        :param TRACE: marks start of traceback copied to log.</span>
<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param caplog: built-in fixture `Pytest caplog`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="k">class</span> <span class="nc">PatchDialog</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_destroy</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_run</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_prime</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prime</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_second</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_destroy</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">def</span> <span class="nf">format_prime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_msg</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prime</span> <span class="o">=</span> <span class="n">p_msg</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_prime</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">def</span> <span class="nf">format_second</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_msg</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">second</span> <span class="o">=</span> <span class="n">p_msg</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_second</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">called_run</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">patch_dialog</span> <span class="o">=</span> <span class="n">PatchDialog</span><span class="p">()</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">,</span>
                            <span class="n">patch_dialog</span><span class="o">.</span><span class="n">destroy</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">,</span> <span class="s1">&#39;format_secondary_text&#39;</span><span class="p">,</span>
                            <span class="n">patch_dialog</span><span class="o">.</span><span class="n">format_second</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="n">patch_dialog</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">,</span> <span class="s1">&#39;set_markup&#39;</span><span class="p">,</span>
                            <span class="n">patch_dialog</span><span class="o">.</span><span class="n">format_prime</span><span class="p">)</span>

        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">I_PRIME</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">I_CAUSE</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">I_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># Test</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ERROR</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ERROR</span><span class="p">()</span> <span class="kn">from</span> <span class="nn">CAUSE</span>
        <span class="n">target</span><span class="o">.</span><span class="n">_report_error_sheet</span><span class="p">(</span><span class="n">p_err</span><span class="o">=</span><span class="n">exc_info</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">p_message</span><span class="o">=</span><span class="n">PRIME</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_dialog</span><span class="o">.</span><span class="n">called_run</span>
        <span class="k">assert</span> <span class="n">patch_dialog</span><span class="o">.</span><span class="n">called_destroy</span>
        <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span>
        <span class="n">log_prime</span> <span class="o">=</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">I_PRIME</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s1">&#39;ERROR&#39;</span> <span class="o">==</span> <span class="n">log_prime</span><span class="o">.</span><span class="n">levelname</span>
        <span class="k">assert</span> <span class="n">PRIME</span> <span class="o">==</span> <span class="n">log_prime</span><span class="o">.</span><span class="n">message</span>
        <span class="n">log_cause</span> <span class="o">=</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">I_CAUSE</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s1">&#39;ERROR&#39;</span> <span class="o">==</span> <span class="n">log_cause</span><span class="o">.</span><span class="n">levelname</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;log_cause: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_cause</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="n">log_cause</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">TRACE</span><span class="p">)</span>
        <span class="n">log_error</span> <span class="o">=</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">I_ERROR</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s1">&#39;ERROR&#39;</span> <span class="o">==</span> <span class="n">log_error</span><span class="o">.</span><span class="n">levelname</span>
        <span class="k">assert</span> <span class="n">log_error</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">ERROR</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">patch_dialog</span><span class="o">.</span><span class="n">called_prime</span>
        <span class="k">assert</span> <span class="n">PRIME</span> <span class="o">==</span> <span class="n">patch_dialog</span><span class="o">.</span><span class="n">prime</span>
        <span class="k">assert</span> <span class="n">patch_dialog</span><span class="o">.</span><span class="n">called_second</span>
        <span class="k">assert</span> <span class="n">SECOND</span> <span class="o">==</span> <span class="n">patch_dialog</span><span class="o">.</span><span class="n">second</span></div>

<div class="viewcode-block" id="TestViewSheet.test_save_sheet_except"><a class="viewcode-back" href="../../../test/factsheet_test.view.test_view_sheet.html#factsheet_test.view.test_view_sheet.TestViewSheet.test_save_sheet_except">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;ERROR, PRIME&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">BackupFileError</span><span class="p">,</span>
            <span class="s1">&#39;Factsheet not saved! could not make backup.&#39;</span><span class="p">,),</span>
        <span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">DumpFileError</span><span class="p">,</span> <span class="s1">&#39;Factsheet not saved! could not write file.&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">NoFileError</span><span class="p">,</span> <span class="s1">&#39;Factsheet not saved! no file selected.&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">OpenFileError</span><span class="p">,</span> <span class="s1">&#39;Factsheet not saved! could not open file.&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="s1">&#39;Factsheet not saved! Application is broken!&#39;</span><span class="p">),</span>
        <span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_save_sheet_except</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monkeypatch</span><span class="p">,</span> <span class="n">ERROR</span><span class="p">,</span> <span class="n">PRIME</span><span class="p">,</span> <span class="n">caplog</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;| Confirm save to file.</span>
<span class="sd">        | Case: exceptions.</span>

<span class="sd">        :param monkeypatch: built-in fixture `Pytest monkeypatch`_.</span>
<span class="sd">        :param ERROR: exception test raises.</span>
<span class="sd">        :param PRIME: primary text for notification.</span>
<span class="sd">        :param caplog: built-in fixture `Pytest caplog`_.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Setup</span>
        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">Gtk</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">,</span> <span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">_s</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">patch_control_save</span><span class="p">(</span><span class="n">_self</span><span class="p">,</span> <span class="n">_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ERROR</span><span class="p">()</span>

        <span class="n">monkeypatch</span><span class="o">.</span><span class="n">setattr</span><span class="p">(</span><span class="n">CSHEET</span><span class="o">.</span><span class="n">ControlSheet</span><span class="p">,</span> <span class="s1">&#39;save&#39;</span><span class="p">,</span> <span class="n">patch_control_save</span><span class="p">)</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">CSHEET</span><span class="o">.</span><span class="n">g_control_app</span><span class="o">.</span><span class="n">open_factsheet</span><span class="p">(</span>
            <span class="n">p_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p_time</span><span class="o">=</span><span class="n">BUI</span><span class="o">.</span><span class="n">TIME_EVENT_CURRENT</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">VSHEET</span><span class="o">.</span><span class="n">ViewSheet</span><span class="p">(</span><span class="n">p_control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
        <span class="n">N_PRIME</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Test</span>
        <span class="n">target</span><span class="o">.</span><span class="n">save_sheet</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span>
        <span class="n">log_prime</span> <span class="o">=</span> <span class="n">caplog</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">N_PRIME</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s1">&#39;ERROR&#39;</span> <span class="o">==</span> <span class="n">log_prime</span><span class="o">.</span><span class="n">levelname</span>
        <span class="k">assert</span> <span class="n">PRIME</span> <span class="o">==</span> <span class="n">log_prime</span><span class="o">.</span><span class="n">message</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, 2021, 2022 Gary Grainger

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>